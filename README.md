# 基于UDP的网络直播聊天室

这是一个基于UDP协议的局域网内网络直播聊天室系统，支持视频直播、屏幕共享和实时聊天功能。

## 系统架构

系统分为两个主要部分：

1. **管理员后台**：用于视频直播和系统管理
2. **客户端界面**：用于观看直播和参与聊天

## 技术栈

- **后端**：Python
- **Web框架**：Flask
- **网络通信**：Socket编程（UDP协议）
- **音视频处理**：FFmpeg
- **前端**：HTML, CSS, JavaScript
- **WebSocket**：用于实时聊天功能

## 功能特点

- 基于UDP的音视频流传输
- 本地视频文件播放
- 屏幕实时共享
- 实时聊天功能
- 在线用户统计
- 自动区分管理员和普通用户界面

## 实现原理

### 1. UDP传输机制

系统使用UDP协议进行音视频数据传输，相比TCP，UDP具有更低的延迟，更适合实时流媒体传输。为了解决UDP不可靠的问题，系统实现了以下机制：

- **数据分片与重组**：将大型音视频帧分割成小数据包，在接收端重组
- **序列号机制**：为每个数据包分配唯一序列号，确保按顺序重组
- **确认机制**：接收端发送ACK消息确认成功接收的数据包
- **超时重传**：当未收到ACK时，自动重传数据包
- **拥塞控制**：监控网络状态，动态调整发送速率

### 2. 界面区分机制

系统通过检测访问者的IP地址来区分管理员和普通用户：

- 本机IP（127.0.0.1或局域网内指定的管理员IP）访问时显示管理员后台界面
- 其他IP访问时显示客户端界面

### 3. 音视频处理

使用FFmpeg库进行音视频的采集、编码和解码：

- 支持从摄像头和麦克风采集实时音视频
- 支持屏幕录制和共享
- 支持本地视频文件的播放和传输

## 部署指南

### 环境要求

- Python 3.8+
- FFmpeg
- 必要的Python库（详见requirements.txt）

### 安装步骤

1. 克隆或下载项目代码

2. 安装FFmpeg
   - Windows: 下载FFmpeg并添加到系统PATH
   - Linux: `sudo apt-get install ffmpeg`

3. 安装Python依赖
   ```
   pip install -r requirements.txt
   ```

4. 启动服务器
   ```
   python server.py
   ```

5. 访问系统
   - 管理员后台：http://localhost:5000
   - 客户端界面：http://<服务器IP>:5000

## 使用说明

### 管理员后台

1. 访问 http://localhost:5000 进入管理员后台
2. 选择直播模式：本地视频或屏幕共享
3. 点击「开始直播」按钮开始广播
4. 可在聊天区域查看用户消息和在线人数

### 客户端

1. 访问 http://<服务器IP>:5000 进入客户端界面
2. 自动接收并显示直播内容
3. 在聊天区域输入消息参与聊天
4. 可查看当前在线人数

## 注意事项

- 系统仅在局域网内工作
- 确保防火墙允许UDP通信
- 视频质量会根据网络状况自动调整